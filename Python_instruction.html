<!DOCTYPE HTML>
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="./Rstyle.css" rel="stylesheet">
<!--<link rel="stylesheet" href="./highlight/styles/default.css">-->
<link rel="stylesheet" href="./highlight/styles/monokai.css">
<script src="./highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.4/css/all.css">
<title>Python-instruction</title>
</head>
<body>
 
<div class="lf"></div>
<div class="main">
<div class="fil"></div>

<div id="page_top"><a href="#"></a></div> 
 <a id="top"><h1>&nbsp;Python入門</h1></a>
 
<p>Pythonを使ってグラフを書いたり、データ解析・統計処理をするTipsをまとめます。<br>
スクリプトで図を描くと、グラフの書き直し、データの差し替え等の手間が省けます。<br>
また、データに施した処理が見えやすいのでミスが減り、記録に残るので振り返りやすくなります。<br>
このページの目的は、ひとまず動作する雛形を提供することなので、説明はざっくりです。<br>
基本的には、スクリプトを.pyファイルに保存してコンソールから実行すれば動きます。
</p>
 <h4 align="right" class="td">2020/11/06 Updated</h4>


<!-- <h3 class="ty">実践</h3> -->
<hr>
<ul>
<li><a href="#exe">スクリプトの実行</a></li>
<li><a href="#library">ライブラリ</a></li>
<li><a href="#graph">グラフを描く（基礎編）</a>
    <ul>
    <li><a href="#scatt">散布図</a></li>
    <li><a href="#plot">折れ線グラフ</a></li>
    <li><a href="#bar">棒グラフ</a></li>
    <li><a href="#fnc">数学関数の使用</a></li>
    <li><a href="#sett">図の詳細設定</a></li>
        <ol>
          <li><a href="#range">範囲</a></li>
          <li><a href="#axis">軸</a></li>
          <li><a href="#label">凡例</a></li>
          <li><a href="#title">タイトル</a></li>
          <li><a href="#lett">文字列の挿入</a></li>
          <li><a href="#multi">複数の図</a></li>
        </ol>
    <!-- <li><a href="#log">片対数グラフを描く</a></li> -->
    <li><a href="#csv">csvファイルを読み込んでグラフを描く</a></li>
    <!-- <li><a href="#xlsx">xlsxファイルを読み込んでグラフを描く</a></li>
    <li><a href="#bar">xlsxファイルを読み込んで棒グラフを描く</a></li> -->
    <li><a href="#err">エラーバーをつける</a></li>
    <!-- <li><a href="#mlt">複数のグラフを同時に描く</a></li> -->
 <!--   <li>２軸のグラフを描く</li>
    <li>x軸を連結したグラフを描く</li> -->
    </ul>
</li>
<li><a href="#ograph">グラフを描く（応用編）</a>
  　<ul>
    <li><a href="#obasic">オブジェクト指向インターフェースの基本</a></li>
    <li><a href="#otwin"> 2 軸のグラフ</a></li>
  　</ul>

<li><a href="#fit">フィッティングする</a>
    <ul>
    <li><a href="#peak">ピークをフィッティングする</a></li>
    <li><a href="#peaksub">データの一部を取り出してフィッティングする</a></li>
    </ul>
</li>
<li><a href="#stat">検定する</a></li>
<li><a href="#hist">ヒストグラムを作る</a>
    <ul>
    <li><a href="#hist1">シンプルなヒストグラムを描く</a></li>
    <li><a href="#hist2">ヒストグラム化したデータをいじる</a></li>
    </ul>
</li>
<li><a href="#ode">連立微分方程式を解く</a>
    <ul>
    <li><a href="#ode1">連立微分方程式を解いて時間発展をプロットする</a></li>
    <li><a href="#ode2">連立微分方程式を繰り返し解いて10秒後の成分量を俯瞰する</a></li>
    </ul>
</li>
<li><a href="#twod">二次元のカラーマップを描く</a></li>
</ul>
 
<hr>
 
<ul>
 <li><a href="#install">インストール</a></li>
 <li><a href="#rdoc">関数の使い方に困ったら</a></li>
 <li><a href="#studio">R studioで使う</a></li>
 <li><a href="#terminal">Terminalで使う</a></li>
 <li><a href="#colpt">色の指定</a></li>
</ul>
 
  <hr>

 
 
  <h3><a id="exe" class="tt">スクリプトの実行</a></h3>
  <p>端末で自分の.pyファイルをコマンドによって呼び出す。そのファイルが存在するフォルダで実行すること。
  </p>
  

<pre>
<code class="shell ty"> $ python *****.py 
</code>
</pre>

<hr>

<h3><a id="library" class="tt">ライブラリ</a></h3>
<p>
  Pythonの強みは充実したライブラリ群です。<br>
  主に使うのは数値計算に便利なNumPy、様々な科学計算が可能なSciPy、プロットに便利なMatplotlib、データ解析に強いPandasあたりです。<br>
  これらはデフォルトのPythonでは使えないのでpipコマンドで別途インストールする必要があります。
 </p>
<code class="shell ty">$ pip install numpy scipy matplotlib pandas seaborn</code>
<p>
  ライブラリを使うには.pyファイルの冒頭で宣言が必要です。
</p>
<pre><code class="python ty">
  import numpy as np
  import pandas as pd
  import matplotlib.pyplot as plt
  from scipy.optimize import minimize

</code></pre>
<p>
  numpy, pandas, matplotlib.pyplotは省略名としてnp, pd, pltを使うことが慣例になっているので従いましょう。<br>
  scipyの中のoptimizeモジュールからminimizeというオブジェクトのみを読み込む、といった使い方も可能です。
</p>
 <hr>
 





 <h3><a id="graph" class="tt">グラフを書く</a></h3>



 <a id="scatt"><h4 class="ty">&#9679;散布図</h4></a>

 <img border="0" src="Python-figs\py_Figure_1.png" width="700"><br>

 <p>上図を描くスクリプトを示す。
 <br>
 ライブラリ(それぞれ様々な機能を持つもの)を導入し、略語を命名する。
 <br>
 ここでは、グラフを書くためのmatplotlib.pyplotのみを導入している。
 <br>
 matplotlib.pyplotで、散布図(scatter)を描く。二つの座標の他、マーカーの色や形を変えられる。
 <br>
 最後に plt.show() でグラフを表示させる。
 </p>
 
<pre>
<!-- <code class="ty"> -->
 <code class="python ty"> 
  import matplotlib.pyplot as plt
  # ライブラリ(ここではmatplotlib.pyplot(グラフを書くためのライブラリ))を導入。
  # pltと名づけ、以下pltで呼び出す。
  
  # 散布図を書くときはplt.scatter(), ()内に変数
  plt.scatter(1, 2, c="blue", marker="o", s=20, alpha=0.5)
  # 左からx座標、y座標
  # 以下は任意で c: 色、 marker: 形状、s: サイズ、alpha: 透明度(0~1)

  plt.scatter(2,  4, c="orange",    marker =".")
  plt.scatter(3,  6, c="green",     marker ="v")
  plt.scatter(4,  8, c="red",       marker ="^")
  plt.scatter(5, 10, c="purple",    marker ="s")
  plt.scatter(1,  5, c="brown",     marker ="p")
  plt.scatter(2,  7, c="pink",      marker ="*")
  plt.scatter(3,  9, c="gray",      marker ="h")
  plt.scatter(4, 11, c="olive",     marker ="+")
  plt.scatter(5, 13, c="cyan",      marker ="x")
  plt.scatter(1,  8, c="coral",     marker ="X")
  plt.scatter(2, 10, c="gold",      marker ="D")
  plt.scatter(3, 12, c="skyblue",   marker ="d")
  plt.scatter(4, 14, c="magenta",   marker ="1")
  plt.scatter(5, 16, c="indianred", marker ="2")
 
  plt.show()
  # グラフを表示する。
</code>
</pre>
   
<p>
  <br>
  <br>
  リストを使用して複数点を一度に描くことができる。<br>
  また、マーカーの縁を別の色にすることも可能。
</p>


<pre>
<code class="python ty"> 
  import matplotlib.pyplot as plt

  x_list=[1,  1, 3, 3, 5, 7, 7, 9,  9]
  y_list=[2, 10, 4, 8, 6, 4, 8, 2, 10]
  
  plt.scatter(x_list, y_list, c="red", marker ="o", edgecolors="black")
  # edgecolorsで縁の色を指定。

  plt.show()

</code>
</pre>

<img border="0" src="Python-figs\py_Figure_1'.png" width="700"><br>



<a id="plot"><h4 class="ty">&#9679;折れ線グラフ</h4></a>

<img border="0" src="Python-figs\py_Figure_2.png" width="700"><br>

<p>
<br>
matplotlib.pyplot(plt)で、折れ線グラフ(plot)を描く。横軸、縦軸の系列をリストで指定してみる。
</p>

<pre>
<!-- <code class="ty"> -->
<code class="python ty"> 
  import matplotlib.pyplot as plt

　# プロットする横軸の座標のリスト
  x_list=[ 2, 4, 6, 8, 10, 12, 14]
　# プロットする縦軸の座標のリスト
  y_list=[10, 1, 7, 4,  6,  2,  9]
  # 2つのリストの要素数を同じにする必要がある
  
  # 散布図を書くときはplt.plot(), ()に変数
  plt.plot(x_list, y_list, c="blue", ls="-", lw=2, alpha=0.8)
  # 左からx座標のリスト、y座標のリスト
  # 以下は任意で c: 色、ls: 線のスタイル、lw: 線の太さ、alpha: 透明度(0~1)

  plt.show()
</code>
</pre>
  
<p>
  <br>
  <br>
  折れ線グラフでもmarkerの指定ができる。
</p>


<pre>
<code class="python ty"> 

  import matplotlib.pyplot as plt

  x_list =[ 1,  4,  7]
  y1_list=[10, 12, 10]
  y2_list=[ 7,  9,  7]
  y3_list=[ 4,  6,  4]
  y4_list=[ 1,  3,  1]
  
  # marker: 形状、ms: マーカーの大きさ、mfc: マーカー内部の色、mec: マーカーの縁の色
  plt.plot(x_list, y1_list, c="blue",   ls="-",  marker="o", ms=10, mfc="white", mec="cyan")

  #　mfc, mecは省略した場合、それぞれ線と同じ色になる。
  plt.plot(x_list, y2_list, c="orange", ls="--", marker="^")
  plt.plot(x_list, y3_list, c="green",  ls=":",  marker="s")
  plt.plot(x_list, y4_list, c="red",    ls="-.", marker="d")
  
  
  plt.show()  

</code>
</pre>

<img border="0" src="Python-figs\py_Figure_3.png" width="700"><br>



<a id="bar"><h4 class="ty">&#9679;棒グラフ</h4></a>

<img border="0" src="Python-figs\py_Figure_15.png" width="700"><br>

<p>
<br>
matplotlib.pyplot(plt)で、棒グラフ(plot)を描く。横軸の位置、縦軸の高さの系列をリストで指定してみる。<br>
</p>

<pre>
<!-- <code class="ty"> -->
<code class="python ty"> 
  import matplotlib.pyplot as plt

  # 横軸位置のリスト
  x_list=[ 1, 2, 3, 4, 5, 6]
  # 縦軸高さのリスト
  height=[ 2, 3, 7, 9, 6, 3]
  
  plt.bar(x_list, height, width=1.0, align="center", color="blue", edgecolor="cyan", lw=2, alpha=0.8)
  # 左から x 座標、y 座標
  # 以下は任意で 棒グラフの幅, x座標の指定する位置 ("edge" にすると棒グラフの左端が指定した数字に来る)
  # 棒グラフの色、縁の色と幅、棒グラフの透明度

  plt.show()
  
</code>
</pre>
  
<p>
  <br>
  <br>
  bottom を指定すれば棒グラフの下端を指定でき、積み上げ棒グラフを描くことができる。
</p>

<pre>
<code class="python ty"> 

  import matplotlib.pyplot as plt

  x_list=[ 1, 2, 3, 4, 5, 6]
  height1=[ 2, 3, 7, 9, 6, 3]
  height2=[ 8, 7, 3, 1, 4, 7]
  
  
  plt.bar(x_list, height1, width=0.6, align="center", color="blue")
  plt.bar(x_list, height2, width=0.6, align="center", color="orange",bottom=height1)
  # bottom = height1 にしたことで 1段目の上端が 2段目の下端になる
  
  
  plt.show()
  

</code>
</pre>

<img border="0" src="Python-figs\py_Figure_16.png" width="700"><br>



<a id="fnc"><h4 class="ty">&#9679;数学関数の使用</h4></a>
 
<p>
  numpyの数学関数を用いて関数のグラフを書くことができる。<br>
  <code class="python ty">np.linspace()</code>を使って定義域を決め、この範囲で関数をプロットする。<br>
  括弧内は，（最小値、最大値、計算点の数）で指定する。計算点の数は省略可。<br>
</p>

 
<pre><code class="python ty">
  import matplotlib.pyplot as plt
  import numpy as np
  # numpyを導入。以下npで呼び出す。
  
  # 定義域を0から10、この間に101点とる。
  x=np.linspace(0,10,101)

  # sin関数
  y1=np.sin(x)
  plt.plot(x,y1,c="blue")
  
  # cos関数
  y2=np.cos(x)
  plt.plot(x,y2,c="orange")
  
  plt.show()

</code></pre>

<img border="0" src="Python-figs\py_Figure_4.png" width="700"><br>


<p>
　上の x, y1, y2 はいずれも numpy.ndarray という型のオブジェクトである。<br>
  これはリストのようなもので、要素数101個のリストを np.linspace() を作り、<br>
  その1点ごとにnp.sin()のような数学関数で値を求めてy1に格納している。<br>
  これを plt.plot() で折れ線グラフとして描いてみる。<br>
  x, y1, y2 の最初の2点の値を以下で見てみると、
</p>  

<pre><code class="python ty">
  print(x[0],y1[0],y2[0])
  print(x[1],y1[1],y2[1])
</code></pre>

<p>出力は</p>

<pre><code class="python ty">
  0.0 0.0 1.0
  0.1 0.09983341664682815 0.9950041652780258

</code></pre>
  

<a id="sett"><h4 class="ty">&#9679;グラフの詳細設定</h4></a>

<ol>
<a id="range"><h4 class="ty">1. 範囲</h4></a>
  <p>
    グラフの表示範囲の設定は横軸 plt.xlim(), plt.ylim() で行う。<br>
  </p>


<pre><code class="python ty">

import numpy as np
import matplotlib.pyplot as plt

x=np.linspace(-10,10,100)

# 指数関数
y1=np.exp(x)
y2=np.exp(0.4*x)
y3=np.exp(0.1*x)

plt.plot(x,y1,c="blue")
plt.plot(x,y2,c="orange")
plt.plot(x,y3,c="green")

# x軸の範囲を-2から10
plt.xlim(-2,10)
# y軸の範囲を0から15
plt.ylim(0,15)

plt.show()

</code></pre>

<img border="0" src="Python-figs\py_Figure_5.png" width="700"><br>


<a id="axis"><h4 class="ty">2. 軸</h4></a>

<p>
  グラフを書く際に有用なライブラリの一つに seaborn がある。<br>
  ここではデフォルトスタイルのみ使用することとし、詳細設定は省く。<br>
  seaborn によって背景とグリッド線を入れることができる。<br>
  <br>
  また、
</p>
<pre><code class="python ty">  plt.axis("scaled")</code></pre>
<p>
  によって、x軸、y軸の長さが等しくなるように設定できる。

</p>

<pre><code class="python ty">
  import numpy as np
  import matplotlib.pyplot as plt

  # seaborn を導入。 sns で呼び出す。
  import seaborn as sns
  
  # seaborn をセット。()内で詳細設定ができるが割愛。
  sns.set()
  
  x=np.linspace(-3,3)
  y1=x
  plt.plot(x,y1,c="blue")
  
  y2=x**2
  plt.plot(x,y2,c="orange")
  
  # x軸、y軸を等間隔にする。
  plt.axis("scaled")

  plt.xlim(-2,2)
  plt.ylim(-2,4)
  
  plt.show()
 
</code></pre>

<img border="0" src="Python-figs\py_Figure_6.png" width="700"><br>

<p>
  軸の設定により、片対数グラフを描くことができる。
</p>

<pre><code class="python ty">
  import numpy as np
  import matplotlib.pyplot as plt
  import seaborn as sns
  
  sns.set()
  
  x=np.linspace(-3,3)
  
  y1=10**x
  plt.plot(x,y1,c="blue")
  
  y2=10**(x**2)
  plt.plot(x,y2,c="orange")
  
  # y軸を対数軸に設定
  plt.yscale("log")
  
  plt.axis('scaled')
  plt.xlim(-3,3)
  plt.ylim(10**-4,10**10)
  
  plt.show()
 
</code></pre>

<img border="0" src="Python-figs\py_Figure_7.png" width="700"><br>

<p>
  <br>
  <br>
  軸のラベルは plt.xlabel(), plt.ylabel() で設定できる。
</p>

<pre><code class="python ty">
  import matplotlib.pyplot as plt
  import seaborn as sns
  
  sns.set()
  
  x_list=[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
  y_list=[7.1, 8.3, 10.7, 12.8, 19.5, 23.2, 24.3, 29.1, 24.2, 17.5, 14.0, 7.7]
  
  plt.plot(x_list, y_list, c="blue",marker=".")
  
  # 横軸のラベル
  plt.xlabel("month") 

  # 縦軸のラベル
  plt.ylabel("temperature (°C)")
  
  plt.show()
  
</code></pre>

<img border="0" src="Python-figs\py_Figure_8.png" width="700"><br>

<p>
  <br>
  <br>
  以下の 3~5 にも共通するが、文字の表示に関して文字の大きさとフォントが指定できる。<br>
  文字の大きさは fontsize , フォントは fontname で指定できる。<br>
  日本語に対応しているフォントを指定すれば日本語も表示できる。
</p>

<pre><code class="python ty">
  # 横軸のラベル
  plt.xlabel("月", fontsize=16, fontname="MS Gothic")

  # 縦軸のラベル
  plt.ylabel("気温 (℃)", fontsize=16, fontname="MS Gothic")

</code></pre>

<img border="0" src="Python-figs\py_Figure_8'.png" width="700"><br>


<p>
  <br>
  <br>
  軸の目盛は plt.xticks(), plt.yticks() で指定できる。<br>
  表示させたい数字のリストを渡せばよい。
</p>

<pre><code class="python ty">
  import numpy as np
  import matplotlib.pyplot as plt
  import seaborn as sns
  
  sns.set()
  
  x=np.linspace(-3,3)
  y1=x
  plt.plot(x,y1,c="blue")
  
  y2=x**2
  plt.plot(x,y2,c="orange")
  
  # リストの数字が目盛りとして表示される
  plt.xticks([-2, -1, 1, 1.5])
  plt.yticks([-2, 0, 1, 3])
  
  plt.axis('scaled')
  plt.xlim(-2,2)
  plt.ylim(-2,4)
  
  plt.show()
  
  
</code></pre>

<img border="0" src="Python-figs\py_Figure_7_1.png" width="700"><br>

<p>
  <br>
  <br>
  数字でなく、文字列で表示させることも可能である<br>
  表示させる位置のリスト、表示させる文字列のリストの2つを渡せばよい
</p>

<pre><code class="python ty">
  import numpy as np
  import matplotlib.pyplot as plt
  import seaborn as sns
  
  sns.set()
  
  
  x=np.linspace(0,10,101)
  
  y1=np.sin(x)
  plt.plot(x,y1,c="blue")
  
  y2=np.cos(x)
  plt.plot(x,y2,c="orange")
  
  # 円周率を p にしておく
  p=np.pi

  # 位置のリスト
  x_pos=[0,p,2*p,3*p]
  # 文字列のリスト
  x_tick=["0","π","2π","3π"]

  plt.xticks(x_pos,x_tick)
  
  plt.show()
    
</code></pre>

<img border="0" src="Python-figs\py_Figure_7_2.png" width="700"><br>

<a id="label"><h4 class="ty">3. 凡例</h4></a>

<p>
  1つの図に複数のグラフを描く場合、凡例を表示した方が分かりやすい。<br>
  plt.scatter(), plt.plot() の括弧内に凡例名を label で指定し、<br>
  最後に plt.legend() で表示する。

</p>

<pre><code class="python ty">
  import numpy as np
  import matplotlib.pyplot as plt
  import seaborn as sns
  
  sns.set()
  
  x=np.linspace(-1.5,1.5,100)
  
  y1=np.tan(x)
  # 凡例を y = tan (x) に指定
  plt.plot(x,y1,c="blue",label=" y = tan (x)")
  
  y2=np.arctan(x)
  # 凡例を y = arctan (x) に指定
  plt.plot(x,y2,c="orange",label=" y = arctan (x)")
  
  y3=x
  # 凡例を y = x に指定
  plt.plot(x,y3,c="gray",label=" y = x ")
  
  plt.axis('scaled')
  plt.xlim(-1.5,1.5)
  plt.ylim(-1.5,1.5)
  
  # 凡例の表示
  plt.legend()
  plt.show()  

</code></pre>

<img border="0" src="Python-figs\py_Figure_9.png" width="700"><br>

<p>
  <br>
  <br>
 plt.legend() 内で凡例ボックスの詳細設定ができる。
</p>

<pre><code class="python ty">
plt.legend(bbox_to_anchor=(1.02, 1.0), framealpha=0.5, facecolor="lightblue", edgecolor="blue", fontsize=12)
  # bbox_to_anchor で凡例ボックスの位置 (x,y) を設定。数字はグラフの左下を (0,0), 右上を (1,1) としたときの数字。
  # framealpha はボックスの透過度。グラフとボックスが重なる際に有用かもしれない。
  # facecolor はボックスの背景色。edgecolor は縁の色。

</code></pre>

<img border="0" src="Python-figs\py_Figure_9'.png" width="700"><br>

<p>
  <br>
  <br>
 凡例のフォント変更はやや毛色が異なり、fontname による指定はできない。<br>
 代わりに prop = {"family" : "フォント名"} を指定する。<br>
 prop = {"family" : "フォント名","size" : 数字 } とすればフォントサイズも指定できる。<br>
 （prop でフォント名を指定しつつ、 fontsize で大きさを指定、のような併用はできないらしい？）
</p>

<pre><code class="python ty">

import matplotlib.pyplot as plt
import seaborn as sns

sns.set()

x_list=[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
y_list1=[7.1, 8.3, 10.7, 12.8, 19.5, 23.2, 24.3, 29.1, 24.2, 17.5, 14.0, 7.7]
y_list2=[4.0, 4.4, 7.5, 10.1 ,16.8, 21.2, 21.3, 26.6, 22.5, 15.6, 10.8, 3.9]
y_list3=[18.7, 18.7, 20.1, 19.8, 24.8, 28.1, 29.3, 29.4, 27.7, 25.8, 23.4, 19.2]


plt.plot(x_list, y_list1, c="green",marker=".",label="東京")
plt.plot(x_list, y_list2, c="blue",marker=".",label="仙台")
plt.plot(x_list, y_list3, c="orange",marker=".",label="那覇")

plt.xlabel("月", fontsize=12, fontname="MS Gothic")
plt.ylabel("気温 (℃)", fontsize=12, fontname="MS Gothic")

# フォントの設定
plt.legend(prop = {"family" : "MS Gothic","size" : 12})
plt.show()

</code></pre>

<img border="0" src="Python-figs\py_Figure_8''.png" width="700"><br>


<a id="title"><h4 class="ty">4. タイトル</h4></a>

<p>
  plt.title() でタイトルを表示できる。
</p>

<pre><code class="python ty">

import matplotlib.pyplot as plt
import seaborn as sns

sns.set()

x_list=[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
y_list1=[7.1, 8.3, 10.7, 12.8, 19.5, 23.2, 24.3, 29.1, 24.2, 17.5, 14.0, 7.7]
y_list2=[4.0, 4.4, 7.5, 10.1 ,16.8, 21.2, 21.3, 26.6, 22.5, 15.6, 10.8, 3.9]
y_list3=[18.7, 18.7, 20.1, 19.8, 24.8, 28.1, 29.3, 29.4, 27.7, 25.8, 23.4, 19.2]

plt.plot(x_list, y_list1, c="green",marker=".",label="東京")
plt.plot(x_list, y_list2, c="blue",marker=".",label="仙台")
plt.plot(x_list, y_list3, c="orange",marker=".",label="那覇")

plt.xlabel("月", fontsize=12, fontname="MS Gothic")
plt.ylabel("気温 (℃)", fontsize=12, fontname="MS Gothic")

plt.subplots_adjust(left=0.125, right=0.9, bottom=0.2, top=0.9)
# 余白の設定。x 軸のラベルとタイトルで下が窮屈になるため。
# bottom 以外はデフォルト値。bottom は 0.1 がデフォルト。

plt.title("図.1 2020 年の月別平均気温", x=0.5, y=-0.25, fontsize=16, fontname="MS Gothic")
# x, y で位置を設定。数字はグラフの左下を (0,0), 右上を (1,1) としたときの数字。

plt.legend(fontsize=10,  prop = {"family" : "MS Gothic"})
plt.show()

</code></pre>

<img border="0" src="Python-figs\py_Figure_8'''.png" width="700"><br>




<a id="lett"><h4 class="ty">5. 文字列の挿入</h4></a>

<p>
  plt.annotate() で図中に文字列を挿入できる。
</p>

<pre><code class="python ty">
  import numpy as np
  import matplotlib.pyplot as plt
  import seaborn as sns
  
  sns.set()
  
  x=np.linspace(-3,3,100)
  
  y=-x**3+3*x-1
  plt.plot(x,y,c="black",label="$y = -x^{3} + 3x - 1$")
  # 凡例なども含め、文字の表示において $$ で囲むとその中はイタリックで表示できる。
  # さらに $$ の中で ^{} を使うと括弧内を上付き文字、
  # 　　　    　　　 _{} を使うと括弧内を下付き文字にできる。
  
  
  plt.axis('scaled')
  plt.xlim(-3,3)
  plt.ylim(-4,4)
  
  plt.annotate("min (-1, -3)", xy=(-1.7,-3.5), c="blue",fontsize=14,fontname="Times New Roman")
  plt.annotate("max (1, 1)", xy=(0.3,1.2), c="red",fontsize=14,fontname="Times New Roman")
  # 左から文字列、xy で表示する位置、文字の色、文字の大きさ、フォント名
  
  plt.legend(fontsize=12)
  plt.show()  

</code></pre>

<img border="0" src="Python-figs\py_Figure_10.png" width="700"><br>


<a id="multi"><h4 class="ty">6. 複数の図</h4></a>

<p>
  plt.subplot() を使うことで1つの台紙に複数の図を描画することができる。
</p>

<pre><code class="python ty">
  plt.subplot(2,3,1)

</code></pre>

<p>
  としたとき、2行3列で計6個の図が準備される。1行目左から1,2,3, 2行目左から4,5,6と通し番号が付けられ、<br>
  最後に1を指定することで図.1に書きこみがされる。
</p>

<pre><code class="python ty">
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

sns.set()

# 図.1
plt.subplot(2,3,1)
x1=np.linspace(0,3)
y1=x1
y2=x1**2
y3=x1**(0.5)
plt.plot(x1,y1,c="gray")
plt.plot(x1,y2,c="orange")
plt.plot(x1,y3,c="blue")
plt.axis('scaled')
plt.xlim(0,3)
plt.ylim(0,3)
plt.title("図.1", x=0.5, y=-0.35, fontname="MS Gothic")


# 図.2
plt.subplot(2,3,2)
x1=np.linspace(0,3)
y1=x1
y2=x1**2-1
y3=(x1+1)**(0.5)
plt.plot(x1,y1,c="gray")
plt.plot(x1,y2,c="orange")
plt.plot(x1,y3,c="blue")
plt.axis('scaled')
plt.xlim(0,3)
plt.ylim(0,3)
plt.title("図.2", x=0.5, y=-0.35, fontname="MS Gothic")


# 図.3
plt.subplot(2,3,3)
x1=np.linspace(1e-5,3)
y1=x1
y2=np.exp(x1)
y3=np.log(x1)
plt.plot(x1,y1,c="gray")
plt.plot(x1,y2,c="orange")
plt.plot(x1,y3,c="blue")
plt.axis('scaled')
plt.xlim(0,3)
plt.ylim(0,3)
plt.title("図.3", x=0.5, y=-0.35, fontname="MS Gothic")


# 図.4
plt.subplot(2,3,4)
x1=np.linspace(-1,3)
y1=x1
y2=np.sin(x1)
p1=np.linspace(-1,1)
q1=np.arcsin(p1)
q2=np.pi-np.arcsin(p1)
plt.plot(x1,y1,c="gray")
plt.plot(x1,y2,c="orange")
plt.plot(p1,q1,c="blue")
plt.plot(p1,q2,c="blue")
plt.axis('scaled')
plt.xlim(-1,3)
plt.ylim(-1,3)
plt.title("図.4", x=0.5, y=-0.35, fontname="MS Gothic")


# 図.5
plt.subplot(2,3,5)
x1=np.linspace(-1,3)
y1=x1
y2=np.cos(x1)
p1=np.linspace(-1,1)
q1=np.arccos(p1)
q2=-np.arccos(p1)
plt.plot(x1,y1,c="gray")
plt.plot(x1,y2,c="orange")
plt.plot(p1,q1,c="blue")
plt.plot(p1,q2,c="blue")
plt.axis('scaled')
plt.xlim(-1,3)
plt.ylim(-1,3)
plt.title("図.5", x=0.5, y=-0.35, fontname="MS Gothic")


# 図.6
plt.subplot(2,3,6)
x1=np.linspace(-1,1.5)
y1=np.tan(x1)
p1=np.linspace(-1,3)
q1=np.arctan(p1)
q2=p1
plt.plot(p1,q2,c="gray")
plt.plot(x1,y1,c="orange")
plt.plot(p1,q1,c="blue")
plt.axis('scaled')
plt.xlim(-1,3)
plt.ylim(-1,3)
plt.title("図.6", x=0.5, y=-0.35, fontname="MS Gothic")



plt.tight_layout()
# 図と図の間隔を自動で調整してくれる。

plt.show()

</code></pre>

<img border="0" src="Python-figs\py_Figure_11.png" width="700"><br>


</ol>



 <a id="csv"><h4 class="ty">&#9679;csvファイルを読み込む</h4></a>

<p>
 pandasを利用し、csvファイルを読み込む方法を説明する。<br>
 csvファイル、table1.csvをdfと名前をつけて読み込む。<br><br>
 
 <a href="table1.csv" download="table1.csv">table1.csv</a>　　
 (環境によっては .xls でダウンロードされるらしい？)

</p> 
 
<pre><code class="python ty"> df = pd.read_csv('table1.csv')
</code></pre>

<p>
  グラフを描くために任意の列だけ抜き出そう。csvファイル内で x という名前の列は
</p>
<pre><code class="python ty">x=df["x"]</code></pre>
<p>
  で抜き出せる。<br>
  条件式を使うこともできる。yという列の値が0より大きい場合のみxを取り出すとすれば
</p> 
<pre><code class="python ty">x=df[df["y"]>0]["x"]</code></pre>

<p>
  任意の列を抽出し、グラフを描く。<br>
</p> 
<pre><code class="python ty">
  import matplotlib.pyplot as plt
  import seaborn as sns
  
  # pandas を導入。 pd で呼び出す。
  import pandas as pd
    
  sns.set()
    
  # table1.csv を読み込み、df と名前を付ける。
  df = pd.read_csv("table1.csv")
  
  plt.subplot(1,3,1)
  # x の列を抜き出す。
  x=df["x"]
  # y の列を抜き出す。
  y=df["y"]
  plt.scatter(x,y,c="blue",marker=".",s=20)
  plt.xlim(0,6)
  plt.ylim(-100,200)
    

  plt.subplot(1,3,2)
  # 条件付きで抜き出す。
  x=df[df["y"]>0]["x"]
  y=df[df["y"]>0]["y"]
  plt.scatter(x,y,c="orange",marker="d",s=20)
  plt.xlim(0,6)
  plt.ylim(-100,200)
    
  
  plt.subplot(1,3,3)
  # 複数の条件は () & () のように & でつなげる。
  x=df[(df["y"]>0)&(df["x"]>2.5)]["x"]
  y=df[(df["y"]>0)&(df["x"]>2.5)]["y"]
  plt.scatter(x,y,c="red",marker="^",s=20)
  plt.xlim(0,6)
  plt.ylim(-100,200)
  
  plt.tight_layout()
  plt.show()
    
</code></pre>
<img border="0" src="Python-figs\py_Figure_12.png" width="700"><br>





 <a id="err"><h4 class="ty">&#9679;エラーバーをつける</h4></a>
 
<p>
  エラーバー付きのプロットは<code class="python ty">plt.errorbar</code>でできます。
</p>

<pre><code class="python ty">
  import matplotlib.pyplot as plt
  import seaborn as sns
  
  sns.set()
  
  plt.errorbar(3, 6, xerr = 1, yerr =2 , capsize=3, fmt='.', markersize=20, color="white", markeredgecolor="cyan", ecolor="blue")
  # (x,y)=(3,6)　にプロット。xerr, yerr でエラーバーの長さ。x = 3 ± 1, y = 6 ± 2　の形になる。
  #  以降は省略可能で、
  #　capsize:xのエラーバーが ┣─○─┫ のように表示されるとき、縦線部の長さ（yだと横線部）
  #　fmt, markersize: マーカーの形、大きさ
  #　color, markeredgecolor, ecolor: マーカー、マーカーの縁、エラーバーの色


  plt.axis('scaled')
  plt.xlim(0,10)
  plt.ylim(0,10)
  
  plt.show()
  
</code></pre>
<img border="0" src="Python-figs\py_Figure_13.png" width="700"><br>


<p>
  <br><br>
  上のcsvファイルからグラフを書いてみる。
</p>
<pre><code class="python ty">
  import matplotlib.pyplot as plt
  import seaborn as sns
  import pandas as pd
    
  sns.set()
    
  df = pd.read_csv("table1.csv")
  
  x=df["x"]
  y=df["y"]
  x_error=df["x_error"]
  y_error=df["y_error"]
  
  plt.errorbar(x, y, xerr = x_error, yerr = y_error, capsize=3, fmt='.',markersize=10, color="white", markeredgecolor="cyan", ecolor="blue")
  
  plt.xlim(0,6)
  plt.ylim(-100,200)
  
  plt.show()
  
</code></pre>
<img border="0" src="Python-figs\py_Figure_14.png" width="700"><br>





 <br><br><a href="#top">Back to TOP</a>
  <hr>

<h3><a id="ograph" class="ty">グラフを描く（応用編）</a></h3>
<p>
matplotlib でグラフを作る際には2つの方式がある。<br>
1つは「Pyplotインターフェース」と呼ばれるもので、ここまで説明してきたものはすべてPyplotインターフェースである。<br>
もう1つは「オブジェクト指向インターフェース」であり、Pyplotインターフェースより詳細な設定ができる。<br>
ここでは基礎的な説明にとどめ、有用でかつPyplotインターフェースでは実装できないものがあった際に追記することにする。<br>
また、両者を混同させて記述することも可能であるため、Pyplotインターフェースをベースとしその箇所のみオブジェクト指向インターフェースで記述することにする。<br>
インターネット上ではオブジェクト指向インターフェースで書かれた解説ページも多いため様式を理解しておくとよい。<br>
<br><br>
</p>

<a id="obasic"><h4 class="ty">&#9679;オブジェクト指向インターフェースの基本</h4></a>

<p>

</p>


<pre>

<code class="python ty"> 

</code>
</pre>
  


<img border="0" src="Python-figs\py_Figure_1'.png" width="700"><br>

<a id="otwin"><h4 class="ty">&#9679;2軸グラフ</h4></a>


<p>

</p>


<pre>

<code class="python ty"> 

</code>
</pre>
  


<img border="0" src="Python-figs\py_Figure_1'.png" width="700"><br>







 <h3><a id="fit" class="tt">フィッティングする</a></h3>

 <a id="peak"><h4 class="ty">&#9679;ピークをフィッティングする</h4></a>

 <img border="0" src="./figs/fitting1.jpg" width="600"><br>

 <p>上図を描くスクリプトです．</p>
 
 <p><a href="./figs/testdata_peak.csv" target="_blank">デモデータ（testdata_peak.csv）</a></p>

<pre><code class="r ty"> 
# 必要に応じて最初に install.packages("nlme")
library(nlme)

# plot parameters
xmin<-  0.0
xmax<-  300.0
ymax<-  300.0
ymin<-  0.0


pdf("fitting_.pdf", width = 20/2.54, height = 12/2.54)
par(mar = c(4.5, 4.5, 2.5, 2.5)) #  余白の広さを行数で指定．下，左，上，右の順．
par(mgp = c(4, 1.2, 0))        #  余白の使い方．説明，ラベル，軸の位置を行で指定．
tck = -0.03 # 目盛線の長さ
cexaxis=1.2

d <- c(1,1)
plot(d,d,
      type = 'n',
      ylim=c(ymin,ymax),
      xlim=c(xmin,xmax), 
      pch=1,
      cex=1, 
      xaxt="n", 
      yaxt="n", 
      xaxs="r", 
      yaxs="r", 
      xlab=NA, 
      ylab=NA,)


# データを読み込む
da <- read.csv('testdata_peak.csv',header=F,skip=0)

# エラーバーを描く
arrows (da$V1,da$V2-sqrt(da$V2)/2,da$V1,da$V2+sqrt(da$V2)/2, col="black",code = 3, lwd = 1, angle = 90, length = 0.03)
# 点をプロットする
points (da$V1,da$V2, col="black", cex=1.0,pch= 1,lty=1, lwd=1)

# 回帰曲線（非線形最小二乗法）
fit = gnls(
V2 ~ a + b*exp(-c*(V1-d)**2), #フィッティングする式
data = da, #どのデータをつかうか
start = list( a=10.0, b=200.0, c=0.01, d=120.0), #初期値
weights = varPower(fixed=0.5), #おまじない
control = list(nlsTol=1e-5) #収束の判定
)

# フィッテイング結果の情報を出力
print(summary(fit))


# フィッテイングした結果の曲線をグラフに書く
xx <- seq(xmin,xmax,length=300)
prefit = predict(fit, newdata=data.frame("V1"=xx))
lines(xx,prefit,col="red",lty=1,lwd=3)

axis(side=1, 
     las=FALSE,
     tck=tck, 
     cex.axis=cexaxis, 
     family="sans",)

axis(side=2, 
     las=TRUE, 
     tck=tck, 
     cex.axis=cexaxis,
     family="sans",
)

box()
dev.off()
</pre>
 </code> 



<p>Rコンソールでの出力（フィッティング結果の情報）</p>
<pre><code class="nohighlight ty">
Generalized nonlinear least squares fit
  Model: V2 ~ a + b * exp(-c * (V1 - d)^2)
  Data: da
       AIC      BIC    logLik
  1739.886 1758.405 -864.9429

Variance function:
 Structure: Power of variance covariate
 Formula: ~fitted(.)
 Parameter estimates:
power
  0.5

Coefficients:
      Value Std.Error   t-value p-value
a  30.54003 0.2512761  121.5398       0
b 204.19678 2.2980325   88.8572       0
c   0.00256 0.0000472   54.2655       0
d 150.13128 0.1432365 1048.1359       0

 Correlation:
  a      b      c
b -0.031
c  0.267  0.573
d -0.001  0.002 -0.007

Standardized residuals:
        Min          Q1         Med          Q3         Max
-2.85535739 -0.89278584  0.08398119  0.83289111  1.80946192

Residual standard error: 0.6736835
Degrees of freedom: 300 total; 296 residual
</code></pre>




 <a id="peaksub"><h4 class="ty">&#9679;一部のピークのみ抜き出してフィッティングする</h4></a>

 <img border="0" src="./figs/plot_peaksub.jpg" width="600"><br>

 <p><code class="r ty">subset</code>を使って，フィッティング専用のデータフレームを作ればよい．</p>
 
 <p><a href="./figs/testdata_peaksub.csv" target="_blank">デモデータ（testdata_peaksub.csv）</a></p>

<pre>
 <code class="r ty"> 
# 必要に応じて最初に install.packages("nlme")
library(nlme)

# plot parameters
xmin<-  0.0
xmax<-  300.0
ymax<-  120.0
ymin<-  0.0

pdf("plot_.pdf", width = 20/2.54, height = 12/2.54)
par(mar = c(4.5, 4.5, 2.5, 2.5)) #  余白の広さを行数で指定．下，左，上，右の順．
par(mgp = c(4, 1.2, 0))        #  余白の使い方．説明，ラベル，軸の位置を行で指定．
tck = -0.03 # 目盛線の長さ
cexaxis=1.2

d <- c(1,1)
plot(d,d,
      type = 'n',
      ylim=c(ymin,ymax),
      xlim=c(xmin,xmax), 
      pch=1,
      cex=1, 
      xaxt="n", 
      yaxt="n", 
      xaxs="r", 
      yaxs="r", 
      xlab=NA, 
      ylab=NA,)

da <- read.csv('testdata_peaksub.csv',header=F,skip=0)

arrows (da$V1,da$V2-sqrt(da$V2)/2,da$V1,da$V2+sqrt(da$V2)/2, col="black",code = 3, lwd = 1, angle = 90, length = 0.03)
points (da$V1,da$V2, col="black", cex=1.0,pch= 1,lty=1, lwd=1)

#１列目がfxmnからfxmxまでのデータを抜き出す
fxmn = 90
fxmx = 150
sa <- subset(da,da$V1>=fxmn & da$V1 <=fxmx)

#フィッティングする範囲をグラフに描いておく
abline(v=fxmn,col="#FF922B",lwd=1)
abline(v=fxmx,col="#FF922B",lwd=1)
arrows(fxmn,ymax*0.95,fxmx,ymax*0.95,code=3,length = 0.10,col="#FF922B")


# 回帰曲線（非線形最小二乗法）
fit = gnls(
V2 ~ a + b*exp(-c*(V1-d)**2), #フィッティングする式
data = sa, #どのデータをつかうか
start = list( a=10.0, b=200.0, c=0.01, d=120.0), #初期値
weights = varPower(fixed=0.5), #おまじない
control = list(nlsTol=1e-5) #収束の判定
)
print( "==============================================================" )
# フィッテイング結果の情報を出力
print(summary(fit))
print( "==============================================================" )
# フィッテイングした結果の曲線をグラフに書く
xx <- seq(fxmn,fxmx,length=300)
prefit = predict(fit, newdata=data.frame("V1"=xx))
lines(xx,prefit,col="red",lty=1,lwd=3)


axis(side=1, 
     las=FALSE,
     tck=tck, 
     cex.axis=cexaxis, 
     family="sans",)


axis(side=2, 
     las=TRUE, 
     tck=tck, 
     cex.axis=cexaxis,
     family="sans",
)



box()
dev.off()
</pre>
 </code> 




 <br><br><a href="#top">Back to TOP</a>
  <hr>


 <h3><a id="stat" class="tt">検定する</a></h3>
<p>
検定は様々な関数が用意されています．実行すると，結果と付随する情報が出力されます．<br>
ここでは，親データから何らかの条件でフィルターして検定するスクリプトを紹介します．
</p>
 
<p><a href="./figs/testdata.csv" target="_blank">デモデータ（testdata.csv）</a></p>


<p>スクリプト</p>
<pre>
<code class="r ty"> 
data <- read.csv('testdata.csv',header=F,skip=0)

# dataから１列目が１であるものを抜き出す
sdata <- subset(data, data$V1 == 1 ,  c(V2,V3,V4,V5))

print( "==============================================================" )
# 読みこんだデータの概要
print(summary(data))
print( "==============================================================" )
# t検定
print( t.test(sdata$V2,sdata$V3,var.equal=T) )
print( "==============================================================" )
# F検定
print( var.test(sdata$V2,sdata$V5,var.equal=T) )
print( "==============================================================" )
# 無相関検定
print( cor.test(sdata$V2,sdata$V3,method="pearson") )
print( "==============================================================" )
</code>
</pre>

<p>出力結果</p>
<pre>
<code class="nohighlight ty"> 
> source('rscript.r')
[1] "=============================================================="
       V1              V2                  V3                 V4
 Min.   :0.000   Min.   :0.0000567   Min.   :0.001791   Min.   :-0.03723
 1st Qu.:2.000   1st Qu.:0.2374926   1st Qu.:0.245031   1st Qu.: 0.23094
 Median :4.000   Median :0.4798864   Median :0.479479   Median : 0.47874
 Mean   :3.925   Mean   :0.4877129   Mean   :0.499339   Mean   : 0.48765
 3rd Qu.:6.000   3rd Qu.:0.7497028   3rd Qu.:0.756424   3rd Qu.: 0.74319
 Max.   :8.000   Max.   :0.9989265   Max.   :0.998886   Max.   : 1.03703
       V5                  V6               V7
 Min.   :0.0001928   Min.   :0.0000535   Mode:logical
 1st Qu.:0.4642972   1st Qu.:0.1902790   NA's:1000
 Median :0.8321843   Median :0.3755209
 Mean   :0.6986144   Mean   :0.3765137
 3rd Qu.:0.9751899   3rd Qu.:0.5464797
 Max.   :0.9999283   Max.   :0.8383903
[1] "=============================================================="

	Two Sample t-test

data:  sdata$V2 and sdata$V3
t = -1.8449, df = 234, p-value = 0.06632
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.148015188  0.004861086
sample estimates:
mean of x mean of y
0.4536442 0.5252212

[1] "=============================================================="

	F test to compare two variances

data:  sdata$V2 and sdata$V5
F = 0.79422, num df = 117, denom df = 117, p-value = 0.2142
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.5518048 1.1431384
sample estimates:
ratio of variances
         0.7942224

[1] "=============================================================="

	Pearson's product-moment correlation

data:  sdata$V2 and sdata$V3
t = -0.77048, df = 116, p-value = 0.4426
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.2489039  0.1108340
sample estimates:
        cor
-0.07135488
[1] "=============================================================="
</code>
</pre>
 


 <br><br><a href="#top">Back to TOP</a>

   <hr>

 
 
 <h3><a id="hist" class="tt">ヒストグラムを作る</a></h3>

 <a id="hist1"><h4 class="ty">&#9679;シンプルなヒストグラムを描く</h4></a>

 <img border="0" src="./figs/hist_a.jpg" width="600"><br>

 <p>上図を描くスクリプトです．
 <br>
 hist関数でヒストグラム化すると同時にグラフも書きます．
 </p>
 <p><a href="./figs/testdata_hist.csv" target="_blank">デモデータ（testdata_hist.csv）</a></p>

<pre><code class="r ty">
# plot area
 xmax<- 300
 xmin<- 0
 ymax<- 60
 ymin<- 0

pdf("hist_.pdf", width = 30/2.54, height = 15/2.54)
par(mar = c(3.0, 8.0, 2, 2)) #  余白の広さを行数で指定．下，左，上，右の順．
par(mgp = c(4, 1.2, 0))        #  余白の使い方．説明，ラベル，軸の位置を行で指定．
tck = -0.04 # 目盛線の長さ
cexaxis=1.5

d <- c(0,0)
plot(d,d,
      type = 'n',
      ylim=c(ymin,ymax),
      xlim=c(xmin,xmax),
      pch=1,
      cex=1,
      xaxt="n",
      yaxt="n",
      xaxs="r",
      xlab=NA,
      ylab=NA)

# データを読み込む
 data <- read.csv('testdata_hist.csv',header=F,skip=0)

# ２列目をヒストグラム化する．breaksにbinの数を入れる．prob=Tとすると面積が規格化される
 hist1 <- hist(data$V2, col = "#FFA903", border = "#FFA903", breaks =  100, add=T, lwd=1, prob=F, plot=T)

  yrange <- c(xmin,xmax) # 範囲
  tickValues <- pretty(yrange) # 自動で区分け
  tickStrings <- sprintf("%.0f",tickValues) # 小数点以下3桁まで表示
  axis(side=1,
       las=FALSE,
       tck=tck,
       cex.axis=cexaxis,
       at=tickValues,
       labels=tickStrings,
       family="sans",)
  
  yrange <- c(ymin,ymax) # 範囲
  tickValues <- pretty(yrange) # 自動で区分け
  tickStrings <- sprintf("%.0f",tickValues) # 小数点以下3桁まで表示
  axis(side=2,
       las=TRUE,
       tck=tck,
       cex.axis=cexaxis,
       family="sans",
       at=tickValues,
       labels=tickStrings,
  )
  
box()
dev.off()
</pre></code>

 <a id="hist2"><h4 class="ty">&#9679;ヒストグラム化したデータをいじる</h4></a>

 <img border="0" src="./figs/hist_b.jpg" width="600"><br>

 <p>上図を描くスクリプトです．
 <br>
 hist関数でヒストグラム化し，binごとの点をプロットし，エラーバーをつけます．
 </p>
 <p><a href="./figs/testdata_hist.csv" target="_blank">デモデータ（testdata_hist.csv）</a></p>

<pre><code class="r ty">
# plot area
 xmax<- 300
 xmin<- 0
 ymax<- 60
 ymin<- 0

pdf("hist_.pdf", width = 30/2.54, height = 15/2.54)
par(mar = c(3.0, 8.0, 2, 2)) #  余白の広さを行数で指定．下，左，上，右の順．
par(mgp = c(4, 1.2, 0))        #  余白の使い方．説明，ラベル，軸の位置を行で指定．
tck = -0.04 # 目盛線の長さ
cexaxis=1.5

d <- c(0,0)
plot(d,d,
      type = 'n',
      ylim=c(ymin,ymax),
      xlim=c(xmin,xmax),
      pch=1,
      cex=1,
      xaxt="n",
      yaxt="n",
      xaxs="r",
      xlab=NA,
      ylab=NA)

#データを読み込む
 data <- read.csv('testdata_hist.csv',header=F,skip=0)
#２列目をヒストグラム化，プロットはしない
 hist1 <- hist(data$V2, breaks =  100, plot=F)
#binの中央の位置に，集計された数をプロットする
 points (hist1$mids,hist1$counts, lwd = 1, pch=21, col="black", bg="black",cex=0.5)
#エラーバーをつける
 arrows (hist1$mids,hist1$counts-sqrt(hist1$counts),hist1$mids,hist1$counts+sqrt(hist1$counts),code=3,lwd=1,angle=90,length=0.03)


  yrange <- c(xmin,xmax) # 範囲
  tickValues <- pretty(yrange) # 自動で区分け
  tickStrings <- sprintf("%.0f",tickValues) # 小数点以下3桁まで表示
  
  axis(side=1,
       las=FALSE,
       tck=tck,
       cex.axis=cexaxis,
       at=tickValues,
       labels=tickStrings,
       family="sans",)
  
  yrange <- c(ymin,ymax) # 範囲
  tickValues <- pretty(yrange) # 自動で区分け
  tickStrings <- sprintf("%.0f",tickValues) # 小数点以下3桁まで表示
  axis(side=2,
       las=TRUE,
       tck=tck,
       cex.axis=cexaxis,
       family="sans",
       at=tickValues,
       labels=tickStrings,
  )

box()
dev.off()
</pre></code>






<br><br><a href="#top">Back to TOP</a>

   <hr>

 
 
 <h3><a id="ode" class="tt">連立微分方程式を解く</a></h3>
 
 <a id="ode1"><h4 class="ty">&#9679;連立微分方程式を解いて時間発展をプロットする</h4></a>

<p>下図のように，３つの成分の時間発展を計算して，その変化をグラフに表示するスクリプトを紹介します．
<br>
解くべき方程式を自作の関数に書き込み，時間ステップを指定してode関数によって解きます．
<br>答えは行列に成分の順番に格納されているので，これをlines関数でプロットしています．
</p>

<img border="1" src="./figs/ode_note.jpg" width="600"><br>

<pre>
 <code class="r ty"> 
# 使う前に install.packages("deSolve") 

library(deSolve)

# プロットする範囲
 xmin<- 0
 xmax<- 20
 ymax<- 1.0
 ymin<-  0

# グラフをpdfで出力
pdf("ode_eg.pdf", width = 15/2.54, height = 12/2.54)

par(mar = c(5.0, 5.0, 3, 3)) #  余白の広さを行数で指定．下，左，上，右の順．
par(mgp = c(4, 1.2, 0))        #  余白の使い方．説明，ラベル，軸の位置を行で指定．
tck = -0.04 # 目盛線の長さ
cexaxis=1.2

# グラフエリアだけ準備する
d <- c(0,0)
plot(d,d,
      type = 'n',
      ylim=c(ymin,ymax),
      xlim=c(xmin,xmax),
      pch=1,
      cex=1,
      xaxt="n",
      yaxt="n",
      xaxs="i",
      yaxs="i",
      xlab=NA,
      ylab=NA)

# 速度定数の定義　
  rab <- 1.0
  rba <- 0.5
  rbc <- 0.2
# ここに解きたい方程式を書く
  myfunc <- function(t,y,parms){
   dy1 <- - rab*y[1] + rba*y[2]
   dy2 <-   rab*y[1] - rba*y[2] - rbc*y[2]
   dy3 <-   rbc*y[2]
   list(c(dy1,dy2,dy3))
 }

# 初期値
  yini <- c(y1=1, y2=0,y3=0)
# 時間の刻み（0--20まで，0.01刻み）
  tgrid <- seq(0, 20, by=0.01)
# 微分方程式を解いた結果
  out <- ode (times = tgrid, y=yini, func = myfunc, parms=NULL)
# 解が得られているか出力
  print( head(out,n=10) )

# out[,1]に時間が，y1=[,2], y2=[,3], ...と格納されている
  lines(out[,1], out[,2], col="#F73149", lty=1, lwd=2)
  lines(out[,1], out[,3], col="#0094F7", lty=2, lwd=2)
  lines(out[,1], out[,4], col="#F74AE6", lty=3, lwd=2)

# 軸を書く
  yrange <- c(xmin,xmax) # 範囲
  tickValues <- pretty(yrange) # 自動で区分け
  tickStrings <- sprintf("%.0f",tickValues) # 小数点以下0桁まで表示
  
# X軸
  axis(side=1,
       las=FALSE,
       tck=tck,
       cex.axis=cexaxis,
       at=tickValues,
       labels=tickStrings,
       family="sans",)
  

  yrange <- c(ymin,ymax) # 範囲
  tickValues <- pretty(yrange) # 自動で区分け
  tickStrings <- sprintf("%.1f",tickValues) # 小数点以下1桁まで表示
  
# Y軸
  axis(side=2,
       las=TRUE,
       tck=tck,
       cex.axis=cexaxis,
       family="sans",
       at=tickValues,
       labels=tickStrings,
  )
  

box()
dev.off()
 </code>
</pre>
 



 <a id="ode2"><h4 class="ty">&#9679;連立微分方程式を繰り返し解いて10秒後の成分量を俯瞰する</h4></a>


<p><code class="r ty">for</code>ループを使って速度定数を変えながら繰り返し解き，10秒後の成分量を記録します．
試行回数に対して各成分量と目標値との差分（の和）をプロットして俯瞰し，条件を満たす速度定数を探します．
結果は <code class="r ty">write.table</code>で出力します．
</p>

 <img border="0" src="./figs/ode_find2.jpg" width="600"><br>
 
<pre><code class="r ty"> 
# 使う前に install.packages("deSolve") 

library(deSolve)

# プロットする範囲
 xmin<- 0
 xmax<- 216
 ymax<- 1.2
 ymin<-  0

# グラフをpdfで出力
pdf("ode_eg.pdf", width = 20/2.54, height = 12/2.54)

par(mar = c(5.0, 5.0, 3, 3)) #  余白の広さを行数で指定．下，左，上，右の順．
par(mgp = c(4, 1.2, 0))        #  余白の使い方．説明，ラベル，軸の位置を行で指定．
tck = -0.04 # 目盛線の長さ
cexaxis=1.2

# グラフエリアだけ準備する
d <- c(0,0)
plot(d,d,
      type = 'n',
      ylim=c(ymin,ymax),
      xlim=c(xmin,xmax),
      pch=1,
      cex=1,
      xaxt="n",
      yaxt="n",
      xaxs="i",
      yaxs="i",
      xlab=NA,
      ylab=NA)

n=8
df <- data.frame(matrix(rep(NA, n), nrow=1))[numeric(0), ]
colnames(df) <- c("ic","rab","rba","rbc","t","y1","y2","y3")

nab = 6
nba = 6
nbc = 6
ic = 0
for (i in 1:nab){
for (j in 1:nba){
for (k in 1:nbc){
ic = ic +1
print(ic)

# 速度定数の定義　
  rab <- 0.05 + 0.05*(i-1)
  rba <- 0.05 + 0.05*(j-1)
  rbc <- 0.05 + 0.05*(k-1)
# ここに解きたい方程式を書く
  myfunc <- function(t,y,parms){
   dy1 <- - rab*y[1] + rba*y[2]
   dy2 <-   rab*y[1] - rba*y[2] - rbc*y[2]
   dy3 <-   rbc*y[2]
   list(c(dy1,dy2,dy3))
 }

# 初期値
  yini <- c(y1=1, y2=0,y3=0)
# 時間の刻み（0--10まで，0.01刻み）
  nl =  1000
  tgrid <- seq(0, 10, length=nl)
# 微分方程式を解いた結果
  out <- ode (times = tgrid, y=yini, func = myfunc, parms=NULL)
# t=10の値をデータフレームに保存する
  df[ic,] <- c(ic,rab,rba,rbc,out[nl,"time"],out[nl,"y1"],out[nl,"y2"],out[nl,"y3"])

} # k
} # j
} # i

# 解が得られているか出力
  print( head(df,n=10) )

# 試行回数icに対してそれぞれの値をプロットする
  points (df$ic,df$y1, col="#F73149", lty=1, lwd=2, pch=1)
  points (df$ic,df$y2, col="#0094F7", lty=1, lwd=2, pch=1)
  points (df$ic,df$y3, col="#4FE50C", lty=1, lwd=2, pch=1)
# 目標値との差分の和を折れ線でプロットする
  y1goal = 0.6
  y2goal = 0.1
  y3goal = 0.3
  lines  (df$ic,(abs(df$y1-y1goal)+abs(df$y2-y2goal)+abs(df$y3-y3goal)), col="#aaaaaa", lty=1, lwd=2)
  points (df$ic,(abs(df$y1-y1goal)+abs(df$y2-y2goal)+abs(df$y3-y3goal)), col="#aaaaaa",bg="#aaaaaa", lty=1, lwd=2, pch=21, cex=0.6)
# データフレームをファイルに出力する
  write.table(df, "df.csv", append = F, sep = ",", row.names = T, quote = F)

# 軸を書く
  yrange <- c(xmin,xmax) # 範囲
  tickValues <- pretty(yrange) # 自動で区分け
  tickStrings <- sprintf("%.0f",tickValues) # 小数点以下3桁まで表示
  
# X軸
  axis(side=1,
       las=FALSE,
       tck=tck,
       cex.axis=cexaxis,
       at=tickValues,
       labels=tickStrings,
       family="sans",)
  
  yrange <- c(ymin,ymax) # 範囲
  tickValues <- pretty(yrange) # 自動で区分け
  tickStrings <- sprintf("%.1f",tickValues) # 小数点以下3桁まで表示
  
# Y軸
  axis(side=2,
       las=TRUE,
       tck=tck,
       cex.axis=cexaxis,
       family="sans",
       at=tickValues,
       labels=tickStrings,
  )
  
box()
dev.off()
</code></pre>

<p>出力ファイルの冒頭（df.csv）</p>

<pre><code class="nohighlight ty">ic,rab,rba,rbc,t,y1,y2,y3
1,1,0.05,0.05,0.05,10,0.672455090343185,0.24867813151177,0.0788667781450439
2,2,0.05,0.05,0.1,10,0.663401652541804,0.199655832272703,0.136942515185491
3,3,0.05,0.05,0.15,10,0.656176660881707,0.163454654312053,0.180368684806239
4,4,0.05,0.05,0.2,10,0.650341130450326,0.13630446889027,0.213354400659401
5,5,0.05,0.05,0.25,10,0.645572576632117,0.115617998761016,0.238809424606866
6,6,0.05,0.05,0.3,10,0.641631993005794,0.0996040841517488,0.258763922842453
7,7,0.05,0.1,0.05,10,0.722484832732879,0.207809961380856,0.0697052058862633
8,8,0.05,0.1,0.1,10,0.707676870234675,0.170002265552752,0.122320864212574
9,9,0.05,0.1,0.15,10,0.695719607366012,0.141624482020769,0.162655910613215
10,10,0.05,0.1,0.2,10,0.685951713566814,0.119990112379265,0.194058174053917
</code></pre>


<br><br><a href="#top">Back to TOP</a>

   <hr>


 <h3><a id="twod" class="tt">二次元のカラーマップを描く</a></h3>
 <p>三次元の図を色の濃淡で表す図を描くスクリプトです．</p>

 <img border="0" src="./figs/image_a.jpg" width="400"><br>


<pre>
 <code class="r ty"> 
#必要に応じて　install.packages("akima")
#必要に応じて　install.packages("fields")

 library(akima)
 library(fields)

 xmin = 0
 xmax = 10
 ymin = 0
 ymax = 10
 
# x,y座標に対してzの値が指定されたデータフレームを作る．csvから読み込んでも良い．
# ここではsin(x)*sin(y)*x^3*y^3*exp(-x-y)という形の関数を採用する．
 x <- seq(xmin,xmax,length=100)
 y <- seq(ymin,ymax,length=100)
 xx <- seq(length=100^2)
 yy <- seq(length=100^2)
 zz <- seq(length=100^2)
 k=0
 for (i in 1:100){
 for (j in 1:100){
 k =  k + 1
 zz[k] = sin(x[i])*sin(y[j])*x[i]**3*y[j]**3*exp(-x[i]-y[j] )
 xx[k] = x[i]
 yy[k] = y[j]
 }
 }

 data <- data.frame(V1=xx,V2=yy,V3=zz)

# カラーマップを作るための２次元補間を行う．
 dat.interp <- interp(data$V1,data$V2,data$V3,
   xo=seq(min(data$V1), max(data$V1), length =200),
   yo=seq(min(data$V2), max(data$V2), length =200), 
)

# カラーバーの定義
 colPal2 <- colorRampPalette(c("#8C36FF","#2CA7FF","#11FFAC","#BAFF27","#FF8E19","#FF0E16"))

 pdf("image_.pdf",  width = 20/2.54, height = 16/2.54)
 par(mar = c(6.0, 8.0, 4.0,4)) #  余白の広さを行数で指定．下，左，上，右の順．
 par(mgp = c(4, 1.2, 0))        #  余白の使い方．説明，ラベル，軸の位置を行で指定．

# image.plotはカラーバーをつけたグラフを作成する
 image.plot(dat.interp$x,dat.interp$y,dat.interp$z,
       zlim=c(-1.00,1.00),
       xlim=c(xmin,xmax),ylim=c(ymin,ymax),
       legend.mar=8,
       legend.width=1.0,
       xlab=NA, 
       ylab=NA,
       axes=F, #軸は自分で描くのでここではF
       col = colPal2(40),
       cex.axis = 1.2, 
       useRaster=T
      )


# 軸は自分で描く
tck = -0.02
cexaxis = 1.2

axis(side=1, 
     las=F,
     tck=tck, 
     cex.axis=cexaxis, 
     family="sans",)

axis(side=2, 
     las=T,
     tck=tck, 
     cex.axis=cexaxis, 
     family="sans",)


box()
dev.off()
 </code>
</pre>



















<br><br><a href="#top">Back to TOP</a>


  <hr>
  <hr>

 <h3><a id="install" class="tt">インストール</a></h3>
<p>下記参照のこと．</p>

<ul>
<li><a href="https://cran.r-project.org/bin/macosx/" target="_blank" class="ty">R for Mac OS X</a></li>
<li><a href="https://cran.r-project.org/bin/windows/" target="_blank" class="ty">R for Windows</a></li>
<li><a href="http://www.okadajp.org/RWiki/" target="_blank" class="ty">R wiki</a></li>
</ul>

<br><br><a href="#top">Back to TOP</a>

  <hr>

 <h3><a id="rdoc" class="tt">関数の使い方に困ったら</a></h3>
<p>下記サイトなどご参考に．</p>

<a href="https://www.rdocumentation.org/" target="_blank" class="ty">R documentation</a>

<p>あるいはコンソールで
<pre><code class="r ty">> ?lines
</code></pre>
などと入力すればマニュアルが表示される．
</p>


<br><br><a href="#top">Back to TOP</a>

  <hr>




 <h3><a id="studio" class="tt">R studioで使う</a></h3>
 <p>
 ターミナルとRコンソール，ファインダー（エクスプローラー）を統合した環境にR studioがあります．コマンドに慣れていない人はこちらをお勧めします．
 右下のファイル一覧で自分のデータやスクリプトをおいている作業ディレクトリに移動し，「More」から「Set As Working Dirctory」を
選択する．その後，<code class="r ty">source('rscript.r')</code>と左側のコンソールに入力し．実行する．
 </p>

 <img border="0" src="./figs/rstudio.jpg" width="700"><br>

<br><br><a href="#top">Back to TOP</a>

  <hr>

 <h3><a id="terminal" class="tt">Terminalで使う</a></h3>
 <p>
 Terminalで自分の作業ディレクトリに移動する．
 Macではファインダーでoption+command+cでパスコピーし，cdで直接移動すると早い．
<pre><code class="r ty"> $ r</code></pre>
 と入力するとRのコンソールが開くので，<code class="r ty">source('rscript.r')</code>と入力し，実行する．
 終了するには
 <pre><code class="r ty"> > q() </code></pre>
 </p>
 保存するか聞かれるが，n (no) で終了して問題ない．

<br><br><a href="#top">Back to TOP</a>

  <hr>




 <h3><a id="colpt" class="tt">色の指定</a></h3>
 
 <p>グラフを描く際、色を指定する場合が多くある。使える色の名前については
   <a href="https://matplotlib.org/stable/gallery/color/named_colors.html" target="_blank" class="ty">こちら</a>
   を参照。
   色の指定をしない場合、"Tableau Palette" の10色が順に使われる。11色目はtab:blueに戻る。
 </p>
 
 
<!-- <table >
<tr>
<td style="background-color:#000000; color:white" class="ty">#000000</td>
<td style="background-color:#666666" class="ty">#666666</td>
<td style="background-color:#c0c0c0" class="ty">#c0c0c0</td>
<td style="background-color:#FFFFFF" class="ty">#FFFFFF</td>
</tr><tr>
<td style="background-color:#8b0000; color:white" class="ty">#8b0000</td>
<td style="background-color:#F71000" class="ty">#F71000</td>
<td style="background-color:#F74848" class="ty">#F74848</td>
<td style="background-color:#fa8072" class="ty">#fa8072</td>
</tr><tr>
<td style="background-color:#FF8000" class="ty">#FF8000</td>
<td style="background-color:#FFC800" class="ty">#FFC800</td>
<td style="background-color:#F6FF00" class="ty">#F6FF00</td>
<td style="background-color:#FFF678" class="ty">#FFF678</td>
</tr><tr>
<td style="background-color:#008000; color:white" class="ty">#008000</td>
<td style="background-color:#0AD100" class="ty">#0AD100</td>
<td style="background-color:#2FF72F" class="ty">#2FF72F</td>
<td style="background-color:#adff2f" class="ty">#adff2f</td>
</tr><tr>
<td style="background-color:#002FBD; color:white" class="ty">#002FBD</td>
<td style="background-color:#0000FF; color:white" class="ty">#0000FF</td>
<td style="background-color:#00A2FF" class="ty">#00A2FF</td>
<td style="background-color:#00F7E3" class="ty">#00F7E3</td>
</tr><tr>
<td style="background-color:#800080; color:white" class="ty">#800080</td>
<td style="background-color:#AD00F7" class="ty">#AD00F7</td>
<td style="background-color:#F74AE6" class="ty">#F74AE6</td>
<td style="background-color:#F70099" class="ty">#F70099</td>
</tr>
</table> -->
 
<!-- <p>こちらも便利：
  <a href="https://www.colordic.org/" target="_blank" class="ty">Web色見本</a>
</p> -->
 
<br><br><a href="#top">Back to TOP</a>

  <hr>




















 <div class="fil"><small class="ty">Copyright &copy; 2020</small></div>
 <div class="fil"></div>
 
</div>
<div class="rg"></div>
</body>
</html> 

